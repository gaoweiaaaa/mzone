var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FeMonitor=t()}(this,function(){"use strict";function e(){if(!f){f=(new Date).getTime();for(var t=0;t<m.length;t++)m[t](f);document.removeEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.detachEvent&&document.detachEvent("onreadystatechange",e)}}function t(){if(!h){h=(new Date).getTime();for(var e=0;e<p.length;e++)p[e](h);clearTimeout(v),window.removeEventListener?window.removeEventListener("load",t,!1):window.detachEvent&&window.detachEvent("onload",t)}}function n(e){var t=(e||"").split(".");return t.length<=2?e:/(com|edu|gov|net|org|mil)\.[\w]+$/i.test(e)?t.slice(-3).join("."):t.slice(-2).join(".")}function o(e){for(var t=0;t<O.length;t++)O[t](e)}function i(){var e=document.getElementsByTagName("script"),t=document.getElementsByTagName("iframe"),n=[].concat(e).concat(t).length;n!==L&&(0!==L&&o([{}]),L=n)}function r(e){for(var t=n(function(e){var t=(e||"").match(/^(https?:|)\/\/([^/:]+)/),n=!t&&!/:?\/\//.test(e)&&location.hostname;return t&&t[2]||n}(e)),o=0;o<M.length;o++)if(M[o]===t)return!0;return!1}function a(e,t,n){for(var o=document.getElementsByTagName(e),i=[],a=0;a<o.length;a++){var c=o[a].getAttribute(t);c&&!r(c)&&i.push(c.substr(0,y))}i.length>0&&n({type:e,urls:i})}function c(){if($.getItem){var e=(new Date).getTime();e-+$.getItem(B)>108e5&&($.setItem(B,e),I(function(e){C(W.reportUrl,J,e,W.projectID)}))}}function s(){T(function(e){C(W.reportUrl,z,e,W.projectID)})}function d(){_(W.reportUrl,function(e){C(W.reportUrl,F,e,W.projectID)})}function u(){N(function(e){C(W.reportUrl,q,e,W.projectID)},W.whiteList)}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.prototype.hasOwnProperty;for(var n in e)t.call(e,n)&&e[n]&&t.call(W,n)&&(W[n]=e[n])}var f=0,m=[];!function(){var t=document.readyState;if("complete"===t||"loading"!==t&&document.addEventListener)setTimeout(e,1);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(document.attachEvent&&(document.attachEvent("onreadystatechange",e),!f)){var n=!1;try{n=null===window.frameElement&&document.documentElement}catch(e){}if(n&&n.doScroll){var o=Math.ceil(500),i=0;!function e(){if(!f&&i++<o)try{n.doScroll("left"),f=(new Date).getTime();for(var t=0;t<m.length;t++)m[t](f)}catch(t){setTimeout(e,10)}}()}}}();var h=void 0,v=void 0,p=[];!function(){if("complete"===document.readyState)return t();v=setTimeout(t,1e4),window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent&&window.attachEvent("onload",t)}();var y=120,g=800,w=(new Date).getTime(),b=[],E={dns:"",tcp:"",ttfb:"",firstPaintTime:"",domReady:"",load:"",slowResources:[]};!function(e){"function"==typeof e&&(f?e(f):m.push(e))}(function(e){E.domReady=e-w}),function(e){"function"==typeof e&&(h?e(h):p.push(e))}(function(e){E.load=e-w,function(){var e=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance||window.oPerformance,t=e&&e.timing;if(t){var n=t.navigationStart,o=t.msFirstPaint||t.mozFirstPaintTime,i=t.loadEventEnd||(new Date).getTime();if(0===o);else if(o>0)E.firstPaintTime=o-n;else{var r=window.chrome&&window.chrome.loadTimes&&window.chrome.loadTimes(),a=(r||{}).firstPaintTime||0;r&&a>0&&(E.firstPaintTime=1e3*a-n)}E.dns=t.domainLookupEnd-t.domainLookupStart,E.tcp=t.connectEnd-t.connectStart,E.ttfb=t.responseStart-t.requestStart,E.domReady=t.domContentLoadedEventEnd-n,E.load=i-n}for(var c=e&&e.getEntries&&e.getEntries()||[],s=0;s<c.length;s++){var d=c[s],u=d.duration;u>=g&&E.slowResources.push({duration:u,name:d.name.substr(0,y)})}}();for(var t=0;t<b.length;t++)b[t](E)});var I=function(e){"function"==typeof e&&(E.load>0?e(E):b.push(e))},S=!1,T=function(e){S||(S=!0,window.onerror=function(t,n,o,i,r){e({errmsg:t,uri:n.substr(0,y),line:o,column:i,obj:r})})},D=!1,_=function(e,t){window.addEventListener&&!D&&(D=!0,window.addEventListener("securitypolicyviolation",function(n){-1===n.blockedURI.indexOf(e)&&t({documentURI:n.documentURI.substr(0,y),referrer:n.referrer.substr(0,y),blockedURI:n.blockedURI.substr(0,y),violatedDirective:n.violatedDirective,originalPolicy:n.originalPolicy})}))},k=void 0,j=void 0,L=0,U=(new Date).getTime(),O=[],R=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,P=!1,M=[n(location.hostname)],N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];M=M.concat(t),P||(P=!0,function(e,t,n){if(t?"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]):t=[document.body],n=n||{childList:!0},O.push(e),R){j||(j=new R(o));for(var r=0;r<t.length;r++)j.observe(t[r],n)}else i(),k||(k=setInterval(function(){(new Date).getTime()-U<1e4&&clearInterval(k),i()},1e3))}(function(){a("script","src",e),a("iframe","src",e)},[document.body,document.head],null))},K="1",x=function(e){e=e||"default",this.keys=[],this.inited=!1,this.filename=[e,K].join("_")};window.localStorage?x.prototype={_newKey:function(e){return[this.filename,e].join("_")},_addKey:function(e){for(var t=!1,n=0;n<this.keys.length;n++)if(this.keys[n]===e){t=!0;break}t||(this.keys.push(e),localStorage.setItem(this.filename,JSON.stringify(this.keys)))},_delKey:function(e){for(var t=0;t<this.keys.length;t++)this.keys[t]===e&&this.keys.splice(t--,1);localStorage.setItem(this.filename,JSON.stringify(this.keys))},init:function(){this.keys=JSON.parse(localStorage.getItem(this.filename)||"[]")},setItem:function(e,t){e=this._newKey(e),localStorage.setItem(e,t),this._addKey(e)},getItem:function(e){return e=this._newKey(e),localStorage.getItem(e)},remove:function(e){e=this._newKey(e),localStorage.removeItem(e),this._delKey(e)},clear:function(){for(var e=0;e<this.keys.length;e++){var t=this.keys[e];localStorage.removeItem(t)}this.keys=[],localStorage.removeItem(this.filename)}}:/mise/i.exec(navigator.userAgent)&&(x.prototype={_load:function(){try{this.input.load(this.filename)}catch(e){}},_save:function(){try{this.input.save()}catch(e){}},init:function(){if(!this.inited){this.inited=!0;var e=document.createElement("INPUT");e.type="hidden",e.style.display="none",e.addBehavior("#default#userData"),document.body.appendChild(e);var t=new Date;t.setDate(t.getDate()+365),e.expires=t.toUTCString(),this.input=e}},setItem:function(e,t){this.init(),this._load(),this.input.setAttribute(e,t),this._save()},getItem:function(e){return this.init(),this._load(),this.input.getAttribute(e)},remove:function(e){this.init(),this._load(),this.input.removeAttribute(e),this._save()},clear:function(){this.init();var e=new Date;e.setMinutes(e.getMinutes()-1),this.input.expires=e.toUTCString(),this._save()}});var A=[],C=function(e,t,n,o){var i=n;try{"object"!==(void 0===n?"undefined":_typeof(n))&&(i={msg:n}),i.pageUrl=location.href.substr(0,y),i=JSON.stringify(i);var r=[e,["category="+o,"type="+t,"data="+(i=encodeURIComponent(i)),"t="+(new Date).getTime()].join("&")].join("?");((function(){for(var e=0;e<A.length;e++){var t=A[e],n=t.readyState;if("complete"===n||"loaded"===n||t.complete)return t}var o=new Image;return A.push(o),o})()).src=r}catch(e){}},B="performance_storage_key",J="performance",z="error",F="csp",q="injection",W={projectID:"MONITOR_ANONYMOUS",reportUrl:"http://collectlog.58.com/log",whiteList:[]},Y=null,$=new x(B);return l.prototype={init:function(){s(),c(),d(),u()},errorReport:s,performanceReport:c,cspReport:d,injectionReport:u,report:function(e,t){C(W.reportUrl,e,t,W.projectID)},getPerformance:I},l.getInstance=function(e){return Y||(Y=new l(e)),Y},l});