(function(){var isSend=false;var timespan=1411093327735-(new Date).getTime();var timesign=(new Date).getTime()+timespan;var remainTime=parseInt($("#remainTimeReg").val());var isvalidMobile=false;var isvalidMobileCode=false;var isvalidPassword=false;var isvalidRepassword=false;var isvalidUsername=false;var isloginBtn=true;var ismobilebind=0;var isagreement=$("#regAgreementCheckbox").attr("checked");var isVoicecodeBtnshow=false;var isreSendcode=false;var isreSendcodeVoice=false;var targeturl=$("#targeturlReg").val();if(targeturl==""){targeturl="http://my.58.com"}if(targeturl.indexOf("union.58.com")>-1){$("#backtoindex a").attr("href",targeturl)}if(targeturl.indexOf("chinahr.58.com")==-1){$("#regLogo").addClass("regLogo58")}else{$("#regLogo").addClass("regLogoChinahr")}var isIE=navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1&&!(navigator.userAgent.indexOf("Opera")>-1);if(isIE){var IE6=false;var IE7=false;var IE8=false;var IE9=false;var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(navigator.userAgent);var fIEVersion=parseFloat(RegExp["$1"]);IE6=fIEVersion==6;IE7=fIEVersion==7;IE8=fIEVersion==8;IE9=fIEVersion==9}String.prototype.TrimString=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};String.prototype.GetByteCount=function(){var txt=this.replace(/(<.*?>)/gi,"");txt=txt.replace(/([\u0391-\uFFE5])/gi,"11");var count=txt.length;return count};function checkUsername(a){var c=/^[\w|\u4E00-\u9FA5]+$/,d=a.TrimString().GetByteCount();if(d==0){isvalidUsername=false;return"请填写用户名"}else if(d<4){isvalidUsername=false;return"用户名不少于2个汉字，或4个字符(数字，字母和下划线)"}else if(d>20){isvalidUsername=false;return"用户名不超过10个汉字，或20个字符(数字，字母和下划线)"}else if(!a.match(c)){isvalidUsername=false;return"用户名仅可使用汉字、字母、数字或下划线"}else if(a.match("^[\\d]+$")){isvalidUsername=false;return"用户名不能全为数字"}else{isvalidUsername=true;return""}}if(remainTime>0){countResentReg(remainTime,"true");isSend=true}function isContinuousChar(str){var str=str.toLowerCase();var flag=0;for(var i=0;i<str.length;i++){if(str.charCodeAt(i)!=flag+1&&flag!=0)return false;else flag=str.charCodeAt(i)}return true}function isSameChar(str){var str=str.toLowerCase();var flag=0;for(var i=0;i<str.length;i++){if(str.charCodeAt(i)!=flag&&flag!=0)return false;else flag=str.charCodeAt(i)}return true}function checkpwd(password){if(password.length==0){return"请输入密码"}else if(!password.match("^[\\s\\S]{6,}$")){return"密码太短，最少为6位"}else if(!password.match("^(.){6,16}$")){return"新密码不应超过16个字符"}else if(password.match("^[a-z|A-Z]+$")&&(isContinuousChar(password)||isSameChar(password))){return"密码不能为重复字母和连续字母"}else if(password.match("^[\\d]+$")&&(isContinuousChar(password)||isSameChar(password))){return"密码不能为重复数字和连续数字"}else if(isSameChar(password)){return"密码不能全为相同的字符"}else{return true}}$("#regAgreementCheckbox").bind("change",function(){var status=$("#regAgreementCheckbox").attr("checked");isagreement=status;status?$(this).attr("checked","checked"):$(this).removeAttr("checked");if(isvalidMobile&&isvalidMobileCode&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}});function countResentReg(resendtime,isVoiceGetCode){var sel=setInterval(function(){if(resendtime==0){isfirstgetcode=false;$("#regGetcodeBtn").removeAttr("disabled").removeClass("countdown").val("重新获取");if(validMobile($("#regMobile").val())){$("#regGetcodeBtn").addClass("regGetcodeBtnOn").removeClass("regGetcodeBtnColorCCC")}reSendcode=true;clearInterval(sel);return}if(resendtime==50){if(isVoiceGetCode!="true"){isVoicecodeBtnshow=true}$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regVoicecodeTip").removeClass("regVoicecodeTipClear").addClass("regVoicecodeTipKeep")}$("#regGetcodeBtn").attr("disabled","disabled").addClass("countdown").val(resendtime+"S后重新获取").removeClass("regGetcodeBtnOn").addClass("regGetcodeBtnColorCCC");resendtime--},1e3)}function countResentRegVoice(resendtime){var sel=setInterval(function(){if(resendtime==0){isfirstgetcoicecode=false;$("#regVoicecodeBtn").removeAttr("disabled").removeClass("regVoicecodeSending").val("重新发送语音验证");clearInterval(sel);isreSendcodeVoice=true;return}$("#regVoicecodeBtn").attr("disabled","disabled").addClass("regVoicecodeSending").val("发送中("+resendtime+"S)");resendtime--},1e3)}function ISDCaptchaFun(scid,scwidth,sctype,succCallback){var captcha=ISDCaptcha({element:"ISDCaptcha",width:parseInt(scwidth),type:parseInt(sctype),showType:"win",sessionId:scid,winAutoShow:true,successCallback:function successCallback(data){$("#scsuccesstoken").val(data.successToken);var callbackFunction=eval(succCallback);callbackFunction(data)},failCallback:function failCallback(data){}});captcha.init()}$("#regVoicecodeBtn").bind("click",function(){clickLog("from=PC_regist_sj_yy");if(isreSendcodeVoice){clickLog("from=PC_regist_sj_cxyy")}if(validMobile($("#regMobile").val())){getVoiceCodeReg()}});$("#regVoiceValidcodeImgBtn").bind("click",function(){clickLog("from=PC_regist_sj_tpyy");if($("#regValidcode").val().length>3){getVoiceCodeReg()}});function showValidcode(isVoiceValid){$("#regValidcodeBox").show();$("#regValidcodeBg").show();if(isVoiceValid){$("#regVoiceValidcodeBtnbox").show();$("#regValidcodeBtnbox").hide()}else{$("#regVoiceValidcodeBtnbox").hide();$("#regValidcodeBtnbox").show()}}function hideValidcode(){$("#regValidcodeBox").hide();$("#regValidcodeBg").hide()}$("#regValidcodeClose").bind("click",function(){hideValidcode()});function getVoiceCodeReg(){var source=$("#sourceReg").val();var mobile=$("#regMobile").val();var token=$("#tokenReg").val();var voicetype="1";var codetype=$("#codetypeReg").val();var vcodekey=$("#vcodekeyReg").val();var rsaModulus=$("#rsaModulusReg").val();var rsaExponent=$("#rsaExponentReg").val();var validcode=$("#regValidcode").val();var scid=$("#scid").val();var scsuccesstoken=$("#scsuccesstoken").val();var sctoken=$("#sctoken").val();var timesign=(new Date).getTime()+timespan;var mobileEncrypt=encryptString(timesign+encodeURIComponent(mobile),rsaExponent,rsaModulus);var url="//passport.58.com/mobile/getcode?mobile="+mobileEncrypt+"&vcodekey="+vcodekey+"&source="+source+"&token="+token+"&voicetype="+voicetype+"&validcode="+validcode+"&codetype="+codetype+"&scid="+scid+"&scsuccesstoken="+scsuccesstoken+"&sctoken="+sctoken+"&callback=?";$.getJSON(url,function(result){getVoiceCodeRegSucc(result)})}function getVoiceCodeRegSucc(result){$("#regValidcode").val("");var code=result.code;if(result.data.action==0){if(code==0){isreSendcodeVoice=true;$("#tokencodeReg").val(result.data.tokencode);hideValidcode();$("#regValidcodeTipText").html("");countResentRegVoice(60)}}else if(result.data.action==1){if(code==786){$("#regValidcodeTipText").html("图片验证码错误,请重新输入");regGetValidateCode()}else if(code==-1){hideValidcode();$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear");$("#regMobileTipText").html("页面失效，请刷新重试").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}else{hideValidcode();var msg=result.msg;$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html(msg).addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}}else if(result.data.action==3){if(result.data.verifycodetype==0){showValidcode(true);var vcodekey=result.data.vcodekey;$("#vcodekeyReg").val(vcodekey);$("#regValidcodeTipText").html("请先填写图片验证码");regGetValidateCode();return false}else if(result.data.verifycodetype==1){$("#scid").val(result.data.scid);$("#sctoken").val(result.data.sctoken);ISDCaptchaFun(result.data.scid,result.data.scwidth,result.data.sctype,"getVoiceCodeReg");return false}if(code==785){showValidcode(true);var vcodekey=result.data.vcodekey;$("#vcodekeyReg").val(vcodekey);$("#regValidcodeTipText").html("请先填写图片验证码");regGetValidateCode()}}else{hideValidcode();var msg=result.msg;$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html(msg).addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}}var mobileUi={QtoB:function(a){for(var c="",d=0;d<a.length;d++){c+=a.charCodeAt(d)==12288?String.fromCharCode(a.charCodeAt(d)-12256):a.charCodeAt(d)>65280&&a.charCodeAt(d)<65375?String.fromCharCode(a.charCodeAt(d)-65248):String.fromCharCode(a.charCodeAt(d))}return c}};function validMobile(mobile){var numberRegStr=/^\d{11}$/;var regNum=new RegExp(numberRegStr);if(regNum.test(mobile)){var telRegStr=/^(13|14|15|16|17|18|19)\d{9}$/;var reg=new RegExp(telRegStr);if(reg.test(mobile))return true;else return false}else{return false}}function regGetValidateCode(){var vcodekey=$("#vcodekeyReg").val();var time=+new Date;var vcodeimgurl="//passport.58.com/validcode/get?vcodekey="+vcodekey+"&time="+time;$("#regValidImg").attr("src",vcodeimgurl)}$("#regValidImg").bind("click",function(){regGetValidateCode()});function checkMobileCode(){var mobile=$("#regMobile").val();var token=$("#tokenReg").val();var tokencode=$("#tokencodeReg").val();var rsaModulus=$("#rsaModulusReg").val();var rsaExponent=$("#rsaExponentReg").val();var source=$("#sourceReg").val();var mobilecode=$("#regMobileCode").val();var codetype=$("#codetypeReg").val();var mobileEncrypt=encryptString(timesign+encodeURIComponent(mobile),rsaExponent,rsaModulus);var url="//passport.58.com/mobile/pc/domobileregcheck?mobile="+mobileEncrypt+"&token="+token+"&tokencode="+tokencode+"&source="+source+"&mobilecode="+mobilecode+"&codetype="+codetype+"&callback=?";$.getJSON(url,function(result){checkMobileCodeSucc(result)})}function checkMobileCodeSucc(result){var code=result.code;if(code==0){ismobilebind=result.data.ismobilebind;if(ismobilebind==2||ismobilebind==3){$("#regPasswordTip").removeClass("regPasswordTipKeep").addClass("regPasswordTipClear");$("#regPasswordTipText").html("").removeClass("regPasswordTipTextKeep").addClass("regPasswordTipTextClear");$("#regMobileUsername").attr("disabled","disabled");$("#regPassword").attr("disabled","disabled");$("#regRepassword").attr("disabled","disabled");$("#regButton").attr("disabled","disabled");$("#regPasswordLi").addClass("regPasswordLiDisable").removeClass("regPasswordLiAble");$("#regPasswordLi").addClass("regPasswordLiDisable").removeClass("regPasswordLiAble");$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");if(ismobilebind==2){$("#regMobileSureOnlyLogin").show()}else{$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("该手机号绑定账户已达上限，请使用其他手机号注册").addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}}else{$("#regMobileUsername").removeAttr("disabled");$("#regMobileSureOnlyLogin").hide();$("#regPassword").removeAttr("disabled");$("#regRepassword").removeAttr("disabled");$("#regButton").removeAttr("disabled");checkPassword();$("#regButton").css("color","#fff")}}else{$("#regMobileSureOnlyLogin").hide();var msg=result.msg;$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html(msg).addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}}$("#regMobile").bind("blur",function(){$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");$(this).val(mobileUi.QtoB(this.value));if(!validMobile(this.value)){$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请填写正确的手机号").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}else{$("#regMobileTip").removeClass("regMobileTipKeep").addClass("regMobileTipClear");$("#regMobileTipText").html("").removeClass("regMobileTipTextKeep").addClass("regMobileTipTextClear");isvalidMobile=true}if(isVoicecodeBtnshow){$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear")}}).bind("keyup",function(){if(validMobile(this.value)){$("#regGetcodeBtn").addClass("regGetcodeBtnOn").removeClass("regGetcodeBtnColorCCC")}else{$("#regGetcodeBtn").addClass("regGetcodeBtnColorCCC").removeClass("regGetcodeBtnOn")}if(validMobile(this.value)&&isvalidMobileCode&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}}).bind("focus",function(){if(isVoicecodeBtnshow){$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear")}else{$("#regMobileTip").removeClass("regMobileTipKeep").addClass("regMobileTipClear")}$("#regMobileTipText").html("").removeClass("regMobileTipTextKeep").addClass("regMobileTipTextClear");$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")});$("#regValidcode").bind("blur",function(){$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");if($(this).val().length<1){$("#regValidcodeTipText").html("请填写图片验证码")}}).bind("keyup",function(){if($(this).val().length>3){$("#regValidcodeImgBtn").addClass("regValidcodeBtnOn");$("#regVoiceValidcodeImgBtn").addClass("regValidcodeBtnOn")}else{$("#regValidcodeImgBtn").removeClass("regValidcodeBtnOn");$("#regVoiceValidcodeImgBtn").removeClass("regValidcodeBtnOn")}}).bind("focus",function(){$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")});$("#regValidcodeImgBtn").bind("mousedown",function(){if($("#regValidcode").val().length>3){$("#regButton").addClass("regButtonOntouch")}}).bind("mouseup",function(){$("#regButton").removeClass("regButtonOntouch")});$("#regVoiceValidcodeImgBtn").bind("mousedown",function(){if($("#regValidcode").val().length>3){$("#regButton").addClass("regButtonOntouch")}}).bind("mouseup",function(){$("#regButton").removeClass("regButtonOntouch")});$("#regMobileCode").bind("blur",function(){$("#regMobileSure").removeClass("regMobileSureShow").addClass("regMobileSureHide");$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");$(this).val(mobileUi.QtoB(this.value));if($(this).val().length<5){$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("请填写正确的手机动态码").addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}else{$("#regMobileCodeTip").removeClass("regMobileCodeTipKeep").addClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("").removeClass("regMobileCodeTipTextKeep").addClass("regMobileCodeTipTextClear");isvalidMobileCode=true;if($(this).val().length>4&&isSend){checkMobileCode()}else{if(!isSend){$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请点击获取验证码按钮").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}else{$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("请填写正确的手机动态码").addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}}}}).bind("keyup",function(){$(this).val($(this).val().replace(/[^0-9]/g,""));if(isvalidMobile&&$(this).val().length>4&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}}).bind("focus",function(){$("#regMobileSureOnlyLogin").hide();$("#regMobileCode").removeClass("errorBorder");$("#regMobileCodeLi").removeClass("errorBorderLi");$("#regMobileCodeTip").removeClass("regMobileCodeTipKeep").addClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("").removeClass("regMobileCodeTipTextKeep").addClass("regMobileCodeTipTextClear");$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")});$("#regButton").bind("click",function(){$("#regMobile").blur();$("#regMobileUsername").blur();$("#regPassword").blur();$("#regRepassword").blur();if(!isSend){$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请点击获取验证码按钮").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear");return false}if(!isvalidUsername){if($("#regMobileUsername").val()==""){var checkUsernamemsg=checkUsername($("#regMobileUsername").val());$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html(checkUsernamemsg).addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear")}if((IE6||IE7||IE8||IE9)&&$("#regMobileUsername").val()=="用户名"){$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("请填写用户名").addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear")}return false}if(checkpwd($("#regPassword").val())!=true){$("#regPasswordTip").addClass("regPasswordTipKeep").removeClass("regPasswordTipClear");$("#regPasswordTipText").html(checkpwd($("#regPassword").val())).addClass("regPasswordTipTextKeep").removeClass("regPasswordTipTextClear");return false}if($("#regPassword").val()!=$("#regRepassword").val()){$("#regRepasswordTip").addClass("regRepasswordTipKeep").removeClass("regRepasswordTipClear");$("#regRepasswordTipText").html("两次密码不一致，请重新输入").addClass("regRepasswordTipTextKeep").removeClass("regRepasswordTipTextClear");return false}clickLog("from=PC_regist_sj_zcdj");if($("#regMobile").val().length>0&&$("#regMobileCode").val().length>0&&$("#regPassword").val().length>0&&$("#regRepassword").val().length>0){clickLog("from=PC_regist_sj_zcyt");if(ismobilebind==1){clickLog("from=PC_regist_sj_mbzcyt")}}if(isvalidMobile&&isvalidMobileCode&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn&&isSend&&isvalidUsername){clickLog("from=PC_regist_sj_zcqq");if(ismobilebind==0){regCommit()}else if(ismobilebind==1){clickLog("from=PC_regist_sj_mbzcqq");regCommit()}else{return false}}else{return false}}).bind("keyup",function(){}).bind("mousemove",function(){if(isvalidMobile&&isvalidMobileCode&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOntouch")}}).bind("mouseout",function(){$("#regButton").removeClass("regButtonOntouch")});$("#regGetcodeBtn").bind("click",function(){$("#regMobileTip").removeClass("regMobileTipKeep").addClass("regMobileTipClear");$("#regMobileTipText").html("").removeClass("regMobileTipTextKeep").addClass("regMobileTipTextClear");clickLog("from=PC_regist_sj_hqyzm");if(isreSendcode){clickLog("from=PC_regist_sj_cxhq")}if(validMobile($("#regMobile").val())){regGetcode()}else{$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请填写正确的手机号").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}});$("#regValidcodeImgBtn").bind("click",function(){clickLog("from=PC_regist_sj_tpdx");if($("#regValidcode").val().length>3){regGetcode()}});function regGetcode(){$("#regGetcodeBtn").attr("disabled","disabled");var source=$("#sourceReg").val();var mobile=$("#regMobile").val();var token=$("#tokenReg").val();var voicetype=$("#voicetypeReg").val();var codetype=$("#codetypeReg").val();var vcodekey=$("#vcodekeyReg").val();var rsaModulus=$("#rsaModulusReg").val();var rsaExponent=$("#rsaExponentReg").val();var validcode=$("#regValidcode").val();var timesign=(new Date).getTime()+timespan;var mobileEncrypt=encryptString(timesign+encodeURIComponent(mobile),rsaExponent,rsaModulus);var scid=$("#scid").val();var scsuccesstoken=$("#scsuccesstoken").val();var sctoken=$("#sctoken").val();var url="//passport.58.com/mobile/getcode?mobile="+mobileEncrypt+"&vcodekey="+vcodekey+"&source="+source+"&token="+token+"&voicetype="+voicetype+"&validcode="+validcode+"&codetype="+codetype+"&scid="+scid+"&scsuccesstoken="+scsuccesstoken+"&sctoken="+sctoken+"&callback=?";$.getJSON(url,function(result){regGetcodeSucc(result)})}function regGetcodeSucc(result){$("#regValidcode").val("");$("#regGetcodeBtn").removeAttr("disabled");var code=result.code;if(result.data.action==0){if(code==0){if(typeof result.data.isvoice!="undefined"){var isVoiceGetCode=result.data.isvoice;if(isVoiceGetCode==1){countResentReg(60,"true")}else{countResentReg(60,"false")}}else{countResentReg(60,"false")}hideValidcode();isreSendcode=true;$("#tokencodeReg").val(result.data.tokencode);isSend=true;$("#regValidcodeTipText").html("")}}else if(result.data.action==1){if(code==786){$("#regValidcodeTipText").html("图片验证码错误，请重新输入");regGetValidateCode()}else if(code==-1){hideValidcode();$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear");$("#regMobileTipText").html("页面失效，请刷新重试").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}else{hideValidcode();var msg=result.msg;$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear");$("#regMobileTipText").html(msg).addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}}else if(result.data.action==3){if(result.data.verifycodetype==0){var vcodekey=result.data.vcodekey;$("#vcodekeyReg").val(vcodekey);showValidcode(false);$("#regValidcodeTipText").html("请填写图片验证码");regGetValidateCode();return false}else if(result.data.verifycodetype==1){$("#scid").val(result.data.scid);$("#sctoken").val(result.data.sctoken);ISDCaptchaFun(result.data.scid,result.data.scwidth,result.data.sctype,"regGetcode");return false}if(code==785){var vcodekey=result.data.vcodekey;$("#vcodekeyReg").val(vcodekey);showValidcode(false);$("#regValidcodeTipText").html("请填写图片验证码");regGetValidateCode()}}else{hideValidcode();var msg=result.msg;$("#regMobileTip").addClass("regMobileTipKeep").removeClass("regMobileTipClear");$("#regMobileTipText").html(msg).addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}}$("#regLoginBtn").bind("click",function(){clickLog("from=PC_regist_sj_dlmbdj");if(isSend){regCommitLogin()}else{$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请点击获取验证码按钮").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}});$("#regLoginBtnOnlyLogin").bind("click",function(){clickLog("from=PC_regist_sj_dldj");if(isSend){regCommitLogin()}else{$("#regMobileTip").removeClass("regMobileTipClear").addClass("regMobileTipKeep");$("#regMobileTipText").html("请点击获取验证码按钮").addClass("regMobileTipTextKeep").removeClass("regMobileTipTextClear")}});function regCommitLogin(){var source=$("#sourceReg").val();var mobile=$("#regMobile").val();var token=$("#tokenReg").val();var tokencode=$("#tokencodeReg").val();var codetype=$("#codetypeReg").val();var rsaModulus=$("#rsaModulusReg").val();var rsaExponent=$("#rsaExponentReg").val();var mobilecode=$("#regMobileCode").val();var timesign=(new Date).getTime()+timespan;var mobileEncrypt=encryptString(timesign+encodeURIComponent(mobile),rsaExponent,rsaModulus);if(typeof fingerPrint!="undefined"){var fingerprint=fingerPrint.get()}var url="//passport.58.com/mobile/pc/login?mobile="+mobileEncrypt+"&tokencode="+tokencode+"&source="+source+"&token="+token+"&codetype="+codetype+"&mobilecode="+mobilecode+"&fingerprint="+fingerprint+ +"&callback=?";$.getJSON(url,function(result){regCommitLoginSucc(result)})}function regCommitLoginSucc(result){var code=result.code;if(code==0){clickLog("from=PC_regist_sj_dl");if(typeof result.data.fingerprint!="undefined"){fingerPrint.set(result)}window.location.href=targeturl}else if(code==2||code==3){var warnkey=result.data.warnkey;window.location.href="//passport.58.com/warn/ui?targetUrl="+targeturl+"&warnkey="+warnkey+"&source=pc-login&win=pc"}else if(code==-2){$("#regMobileSureOnlyLogin").hide();$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html("页面失效，请刷新重试").addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}else{$("#regMobileCodeTip").removeClass("regMobileCodeTipKeep").addClass("regMobileCodeTipClear");$("#regMobileSureOnlyLogin").hide();var msg=result.msg;$("#regMobileCodeTip").addClass("regMobileCodeTipKeep").removeClass("regMobileCodeTipClear");$("#regMobileCodeTipText").html(msg).addClass("regMobileCodeTipTextKeep").removeClass("regMobileCodeTipTextClear")}}function regCommit(){$("#regButton").attr("disabled","disabled");var source=$("#sourceReg").val();var mobile=$("#regMobile").val();var mobilecode=$("#regMobileCode").val();var token=$("#tokenReg").val();var tokencode=$("#tokencodeReg").val();var rsaModulus=$("#rsaModulusReg").val();var rsaExponent=$("#rsaExponentReg").val();var timesign=(new Date).getTime()+timespan;var password=$("#regPassword").val();var username=encodeURIComponent($("#regMobileUsername").val());var passwordEncrypt=encryptString(timesign+encodeURIComponent(password),rsaExponent,rsaModulus);var mobileEncrypt=encryptString(timesign+encodeURIComponent(mobile),rsaExponent,rsaModulus);if(typeof fingerPrint!="undefined"){var fingerprint=fingerPrint.get()}var url="//passport.58.com/mobile/pc/domobilereg?callback=?&mobile="+mobileEncrypt+"&fingerprint="+fingerprint+"&mobilecode="+mobilecode+"&source="+source+"&token="+token+"&tokencode="+tokencode+"&password="+passwordEncrypt+"&ismobilebind="+ismobilebind+"&username="+username;$.getJSON(url,function(result){regCommitSucc(result)})}function regCommitSucc(result){var code=result.code;$("#regButton").removeAttr("disabled");if(code==0){clickLog("from=PC_regist_sj_zc");if(ismobilebind==1){clickLog("from=PC_regist_sj_mbzc")}if(typeof result.data.fingerprint!="undefined"){fingerPrint.set(result)}var path=$("#pathReg").val();window.location.href=targeturl}else{var msg=result.msg;$("#regRepasswordTip").addClass("regRepasswordTipKeep").removeClass("regRepasswordTipClear");$("#regRepasswordTipText").html(msg).addClass("regRepasswordTipTextKeep").removeClass("regRepasswordTipTextClear")}}if($("#regPasswordText").length>0){$("#regPasswordText").bind("focus",function(){$("#regPasswordText").hide();$("#regPassword").show();$("#regPassword")[0].focus()});$("#regPassword").bind("blur",function(){if($("#regPassword").val()==""){$("#regPasswordText").show();$("#regPassword").hide()}});$("#regRepasswordText").bind("focus",function(){$("#regRepasswordText").hide();$("#regRepassword").show();$("#regRepassword")[0].focus()});$("#regRepassword").bind("blur",function(){if($("#regRepassword").val()==""){$("#regRepasswordText").show();$("#regRepassword").hide()}})}function checkPassword(){$("#regMobileUsername").bind("blur",function(){var isIELow=false;if((IE6||IE7||IE8||IE9)&&$("#regMobileUsername").val()=="用户名"){isIELow=true}else{isIELow=false}$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");var randomId=Math.floor(Math.random()*1e4);var msg=checkUsername($("#regMobileUsername").val());if(msg==""&&!isIELow){$.ajax({url:"/ajax/checknickname?id="+randomId,async:false,data:"nickname="+encodeURIComponent($("#regMobileUsername").val()),success:function(d){if(d=="1"){$("#regMobileUsernameTip").removeClass("regMobileUsernameTipKeep").addClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("").removeClass("regMobileUsernameTipTextKeep").addClass("regMobileUsernameTipTextClear");isvalidUsername=true}else if(d=="2"){$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("用户名不能包含与58同城相关内容").addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear");isvalidUsername=false}else{$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("该用户名已被注册，请使用其他用户名注册").addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear");isvalidUsername=false}}})}else if(isIELow){$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("请填写用户名").addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear");isvalidUsername=false}else{$("#regMobileUsernameTip").addClass("regMobileUsernameTipKeep").removeClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html(msg).addClass("regMobileUsernameTipTextKeep").removeClass("regMobileUsernameTipTextClear");isvalidUsername=false}}).bind("keyup",function(){if(isvalidMobile&&$(this).val().length>4&&isvalidPassword&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}}).bind("focus",function(){$("#regMobileUsernameTip").removeClass("regMobileUsernameTipKeep").addClass("regMobileUsernameTipClear");$("#regMobileUsernameTipText").html("").removeClass("regMobileUsernameTipTextKeep").addClass("regMobileUsernameTipTextClear");$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")});$("#regPassword").bind("blur",function(){$("#passwordlevelBox").addClass("passwordlevelBoxHide").removeClass("passwordlevelBoxShow");$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");var checkpwdval=checkpwd($(this).val());if(checkpwdval!=true){$("#regPasswordTip").addClass("regPasswordTipKeep").removeClass("regPasswordTipClear");$("#regPasswordTipText").html(checkpwdval).addClass("regPasswordTipTextKeep").removeClass("regPasswordTipTextClear");isvalidPassword=false}else{$("#regPasswordTip").removeClass("regPasswordTipKeep").addClass("regPasswordTipClear");$("#regPasswordTipText").html("").removeClass("regPasswordTipTextKeep").addClass("regPasswordTipTextClear");isvalidPassword=true}var password=$("#regPassword").val();var repassword=$("#regRepassword").val();if(password!=repassword){$("#regRepasswordTip").addClass("regRepasswordTipKeep").removeClass("regRepasswordTipClear");$("#regRepasswordTipText").html("两次密码不一致，请重新输入").addClass("regRepasswordTipTextKeep").removeClass("regRepasswordTipTextClear");isvalidRepassword=false}else{$("#regRepasswordTip").removeClass("regRepasswordTipKeep").addClass("regRepasswordTipClear");$("#regRepasswordTipText").html("").removeClass("regRepasswordTipTextKeep").addClass("regRepasswordTipTextClear");isvalidRepassword=true}}).bind("keyup",function(){$("#regPassword")[0].type="password";var password=$(this).val();$("#passwordlevelBox").removeClass("passwordlevelBoxHide").addClass("passwordlevelBoxShow");var c=0;if(password.match(/[a-z]/gi)){c++}if(password.match(/[0-9]/gi)){c++}if(password.match(/(.[^a-z0-9])/gi)){c++}if(password.length<10&&password.length>0){c--}switch(c){case 1:$("#passwordlevel1").addClass("passwordlevelon");$("#passwordlevel2").removeClass("passwordlevelon");$("#passwordlevel3").removeClass("passwordlevelon");break;case 2:$("#passwordlevel1").removeClass("passwordlevelon");$("#passwordlevel2").addClass("passwordlevelon");$("#passwordlevel3").removeClass("passwordlevelon");break;case 3:$("#passwordlevel1").removeClass("passwordlevelon");$("#passwordlevel2").removeClass("passwordlevelon");$("#passwordlevel3").addClass("passwordlevelon");break}if(isvalidMobile&&isvalidMobileCode&&$(this).val().length<6&&isvalidRepassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}}).bind("focus",function(){$("#regPasswordTip").addClass("regPasswordTipKeep").removeClass("regPasswordTipClear");$("#regPasswordTipText").html("请使用6-16字符的密码").addClass("regPasswordTipTextKeep").removeClass("regPasswordTipTextClear");$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")});$("#regRepassword").bind("blur",function(){$(this).removeClass("inputFocus");$(this).parent().removeClass("inputliFocus");var password=$("#regPassword").val();var repassword=$("#regRepassword").val();if(password!=repassword){$("#regRepasswordTip").addClass("regRepasswordTipKeep").removeClass("regRepasswordTipClear");$("#regRepasswordTipText").html("两次密码不一致，请重新输入").addClass("regRepasswordTipTextKeep").removeClass("regRepasswordTipTextClear")}else{$("#regRepasswordTip").removeClass("regRepasswordTipKeep").addClass("regRepasswordTipClear");$("#regRepasswordTipText").html("").removeClass("regRepasswordTipTextKeep").addClass("regRepasswordTipTextClear");
isvalidRepassword=true}}).bind("keyup",function(){$("#regRepassword")[0].type="password";var password=$("#regPassword").val();var repassword=$("#regRepassword").val();if(isvalidMobile&&isvalidMobileCode&&isvalidPassword&&password==repassword&&isagreement&&isloginBtn){$("#regButton").addClass("regButtonOn")}else{$("#regButton").removeClass("regButtonOn")}}).bind("focus",function(){$("#regRepasswordTip").removeClass("regRepasswordTipKeep").addClass("regRepasswordTipClear");$("#regRepasswordTipText").html("").removeClass("regRepasswordTipTextKeep").addClass("regRepasswordTipTextClear");$(this).addClass("inputFocus");$(this).parent().addClass("inputliFocus")})}window.onload=function(){$("#regAgreementBox span").append('& <a id="regAgreementPrivacy" target="_blank" href="http://about.58.com/395.html">《隐私权条款》</a>')}})();